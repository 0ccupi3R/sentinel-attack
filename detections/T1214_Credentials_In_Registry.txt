// Name: Credentials in Registry
// Description: Checks for execution of MITRE ATT&CK T1214
//
// Severity: High
//
// QueryFrequency: 1h
//
// QueryPeriod: 1h
//
// AlertTriggerThreshold: 1
//
// DataSource: #Sysmon
//
// Tactics: #Credential Access
//
SysmonParser
| where EventID == 1 and (CommandLine contains "reg query HKLM \/f password \/t REG_SZ \/s" 
or CommandLine contains "reg query HKCU \/f password \/t REG_SZ \/s"
or CommandLine contains "Get-UnattendedInstallFile"
or CommandLine contains "Get-Webconfig"
or CommandLine contains "Get-ApplicationHost"
or CommandLine contains "Get-SiteListPassword"
or CommandLine contains "Get-CachedGPPPassword"
or CommandLine contains "Get-RegistryAutoLogon")