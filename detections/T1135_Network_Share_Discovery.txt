// Name: Network Share Discovery
// Description: Checks for execution of MITRE ATT&CK T1135
//
// Severity: High
//
// QueryFrequency: 1h
//
// QueryPeriod: 1h
//
// AlertTriggerThreshold: 1
//
// DataSource: #Sysmon
//
// Tactics: #Discovery
//
Event
| where EventID == 1 and Source == "Microsoft-Windows-Sysmon" 
| extend d=parse_xml(EventData)
| where d.DataItem.EventData.Data[4]["#text"] contains "net.exe" 
and (d.DataItem.EventData.Data[9]["#text"] contains "view"
or d.DataItem.EventData.Data[9]["#text"] contains "share")