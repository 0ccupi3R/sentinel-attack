
// Name: Signed Script Proxy Execution
// Description: Checks for excution of MITRE ATT&CK T1216
//
// Severity: Medium
//
// QueryFrequency: 1h
//
// QueryPeriod: 1h
//
// AlertTriggerThreshold: 1
//
// DataSource: #Sysmon
//
// Tactics: #Defense Evasion, #Execution
//
Event
| where EventID == "1" and Source == "Microsoft-Windows-Sysmon" 
| extend d=parse_xml(EventData)
| where d.DataItem.EventData.Data[4]["#text"] contains "cscript"
 or d.DataItem.EventData.Data[4]["#text"] contains "wscript"
 or d.DataItem.EventData.Data[4]["#text"] contains "certutil"
 or d.DataItem.EventData.Data[4]["#text"] contains "jjs"